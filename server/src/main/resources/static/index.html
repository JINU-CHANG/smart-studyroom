<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìŠ¤í„°ë”” ì¹´í˜</title>
    <style>
        .room, .seat {
            cursor: pointer;
            padding: 10px;
            border: 1px solid #ccc;
            margin: 5px;
            border-radius: 5px;
            display: inline-block;
        }
        .selected {
            background-color: lightblue;
        }
        .info-box {
            margin-top: 20px;
            padding: 10px;
            border: 1px dashed #888;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
<h1>ğŸ“šìŠ¤í„°ë”” ì¹´í˜ ğŸ“š</h1>

<!-- ë¡œê·¸ì¸ í™”ë©´ -->
<div id="loginPage" class="login-container">
    <h2>ë¡œê·¸ì¸</h2>
    <input id="id" placeholder="ì•„ì´ë””" />
    <input id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
    <button onclick="login()">ë¡œê·¸ì¸</button>
</div>

<!-- ì˜ˆì•½ í™”ë©´ -->
<div id="mainPage" class="hidden">
    <h2>ì¢Œì„ ì´ìš© í˜„í™©</h2>
    <div id="welcomeMessage" style="margin-bottom: 20px; font-weight: bold;"></div>
    <div id="roomContainer"></div>
    <div id="seatContainer"></div>
    <div id="infoContainer" class="info-box"></div>
</div>

<script>
    const data = [
        {
            name: "ë£¸ 1",
            seats: [
                { name: "ì¢Œì„ 1" },
                { name: "ì¢Œì„ 2" },
                { name: "ì¢Œì„ 3" }
            ]
        },
        {
            name: "ë£¸ 2",
            seats: [
                { name: "Seat 1" }
            ]
        }
    ];

    function login() {
        const id = document.getElementById("id").value.trim();
        const password = document.getElementById("password").value;

        const payload = {
            id: id,
            password: password
        };

        fetch("/login", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        })
            .then(response => {
                if (!response.ok) throw new Error("ë¡œê·¸ì¸ ì‹¤íŒ¨");
                return response.text();
            })
            .then(() => {
                localStorage.setItem("memberId", id);
                document.getElementById("loginPage").classList.add("hidden");
                document.getElementById("mainPage").classList.remove("hidden");

                const welcome = document.getElementById("welcomeMessage");
                welcome.textContent = `í™˜ì˜í•©ë‹ˆë‹¤! ${id} ë‹˜`;
            })
            .catch(error => {
                alert("ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                console.error(error);
            });
    }

    const roomContainer = document.getElementById("roomContainer");
    const seatContainer = document.getElementById("seatContainer");
    const infoContainer = document.getElementById("infoContainer");

    let selectedRoomIndex = null;

    data.forEach((room, roomIndex) => {
        const roomDiv = document.createElement("div");
        roomDiv.className = "room";
        roomDiv.textContent = room.name;
        roomDiv.addEventListener("click", () => showSeats(roomIndex));
        roomContainer.appendChild(roomDiv);
    });

    function showSeats(roomIndex) {
        selectedRoomIndex = roomIndex;
        seatContainer.innerHTML = "";
        infoContainer.innerHTML = "";

        const seats = data[roomIndex].seats;
        seats.forEach((seat, seatIndex) => {
            const seatDiv = document.createElement("div");
            seatDiv.className = "seat";
            seatDiv.textContent = seat.name;
            seatDiv.addEventListener("click", () => showSeatForm(roomIndex, seatIndex));
            seatContainer.appendChild(seatDiv);
        });
    }

    function showSeatForm(roomIndex, seatIndex) {
        const seat = data[roomIndex].seats[seatIndex];
        infoContainer.innerHTML = `
        <h3>${seat.name} ì˜ˆì•½</h3>
        <label>ì‹œì‘ ì‹œê°„: <input type="time" id="startTime" /></label><br/><br/>
        <label>ì¢…ë£Œ ì‹œê°„: <input type="time" id="endTime" /></label><br/><br/>
        <button onclick="reserve(${roomIndex}, ${seatIndex})">ì˜ˆì•½</button>
      `;
    }

    function reserve(roomIndex, seatIndex) {
        const start = document.getElementById("startTime").value;
        const end = document.getElementById("endTime").value;

        if (!start || !end) {
            alert("ì‹œì‘ ì‹œê°„ê³¼ ì¢…ë£Œ ì‹œê°„ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
        }

        const seat = data[roomIndex].seats[seatIndex];
        const today = new Date().toISOString().split("T")[0];
        const memberId = localStorage.getItem("memberId");

        const payload = {
            memberId: memberId,
            seatId: seatIndex + 1,
            startTime: `${today}T${start}`,
            endTime: `${today}T${end}`
        };

        fetch("/reserve", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        }).then(response => {
                if (!response.ok) throw new Error("ì˜ˆì•½ ì‹¤íŒ¨");
                return response.text();
            })
            .then(() => {
                infoContainer.innerHTML = `<strong>${seat.name}</strong> ì˜ˆì•½ ì™„ë£Œ<br/>
                ì‹œì‘: ${start}<br/>ì¢…ë£Œ: ${end}`;
            })
            .catch(error => {
                alert("ì˜ˆì•½ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: " + error.message);
            });
    }
</script>
</body>
</html>
